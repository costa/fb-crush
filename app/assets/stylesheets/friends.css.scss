
// XXX http://joshbroton.com/quick-fix-sass-mixins-for-css-keyframe-animations/

@mixin animation($animate...) {
  $max: length($animate);
  $animations: '';

  @for $i from 1 through $max {
    $animations: #{$animations + nth($animate, $i)};

    @if $i < $max {
      $animations: #{$animations + ", "};
    }
  }
  -webkit-animation: $animations;
  -moz-animation:    $animations;
  -o-animation:      $animations;
  animation:         $animations;
}

@mixin keyframes($animationName) {
  @-webkit-keyframes #{$animationName} {
    @content;
  }
  @-moz-keyframes #{$animationName} {
    @content;
  }
  @-o-keyframes #{$animationName} {
    @content;
  }
  @keyframes #{$animationName} {
    @content;
  }
}

@include keyframes(pulsate) {
  0% { border-radius: 50% }
  5% { border-radius: 40% }
  10% { border-radius: 30% }
  15% { border-radius: 40% }
  20% { border-radius: 50% }
  25% { border-radius: 45% }
  30% { border-radius: 40% }
  35% { border-radius: 45% }
  40% { border-radius: 50% }
  100% { border-radius: 50% }
}

@include keyframes(breathe) {
  0% { border-radius: 50% }
  50% { border-radius: 20% }
  100% { border-radius: 50% }
}

@mixin keyframes-flip-horizontal($width, $name) {
  @include keyframes(flip-horizontal-#{$name}) {
    0% {
      opacity: 1;
      width: $width;
      border-left-width: 0;
      border-right-width: 0;
      border-color: #CCC;
    }
    25% {
      opacity: 0;
      width: 0;
      border-left-width: 3px;
      border-right-width: 3px;
      border-color: #000;
    }
    75% {
      opacity: 0;
      width: 0;
      border-left-width: 3px;
      border-right-width: 3px;
      border-color: #000;
    }
    100% {
      opacity: 1;
      width: $width;
      border-left-width: 0;
      border-right-width: 0;
      border-color: #CCC;
    }
  }
}


// XXX Q&D
.panel.friend {
  box-shadow: none;
}

.panel.panel-default.friend {
  border-color: transparent;
}


@mixin user-name-background($color) {
  .user {
    .name {
      background: $color;
    }
  }
}

@mixin dim($size) {
  width: $size;
  height: $size;
}

@mixin user-picture-dim($size) {
  .user {
    .picture {
      img {
        @include dim($size);
      }
    }
  }
}

@mixin user-picture-fx($animation) {
  .user {
    .picture {
      img:first-child {
        @include animation($animation);
      }
    }
  }
}

@mixin user-picture-alt-fx($animation) {
  .user {
    .picture {
      img:last-child {
        @include animation($animation);
      }
    }
  }
}

@include keyframes-flip-horizontal(100%, hover);
@include keyframes-flip-horizontal(80%, full);
@include keyframes-flip-horizontal(40%, some);
@include keyframes-flip-horizontal(20%, none);

@mixin transform($transforms) {
  -moz-transform: $transforms;
  -o-transform: $transforms;
  -ms-transform: $transforms;
  -webkit-transform: $transforms;
  transform: $transforms;
}

.friend {
  transition: all 0.2s ease;

  .user {
    .picture {
      position: relative;
      width: 100px;
      height: 100px;

      img {
        position: absolute;
        top: 50%;
        left: 50%;
        border-style: solid;
        transition: all 0.2s ease;
        @include transform(translate(-50%, -50%));
      }
      img:last-child {
        @include transform(translate(-50%, -50%) scaleX(-1));
      }
    }
  }

  &.visibility-none {
    @include user-picture-dim(20%);
  }
  &.visibility-some {
    @include user-picture-dim(40%);
  }
  &.visibility-full {
    @include user-picture-dim(80%);
  }

  &.removing {
    @include user-picture-dim(10%);
    opacity: 0.1;
  }

  &.intentness-none {
    @include user-name-background(transparent);
  }
  &.intentness-half {
    @include user-name-background(#EDE);
    @include user-picture-fx('breathe 3s infinite');
  }
  &.intentness-full {
    @include user-name-background(#FDD);
    @include user-picture-fx('pulsate .6s infinite');
  }

  &.hover.visibility-none {
    @include user-picture-fx('flip-horizontal-none .2s infinite linear');
    @include user-picture-alt-fx('flip-horizontal-none .2s infinite .1s linear');
  }
  &.hover.visibility-some {
    @include user-picture-fx('flip-horizontal-some .4s infinite linear');
    @include user-picture-alt-fx('flip-horizontal-some .4s infinite .2s linear');
  }
  &.hover.visibility-full {
    @include user-picture-fx('flip-horizontal-full .8s infinite linear');
    @include user-picture-alt-fx('flip-horizontal-full .8s infinite .4s linear');
  }
  &.visibility-full:hover {
    @include user-picture-dim(100%);
    @include user-picture-fx('flip-horizontal-hover 1s infinite linear');
    @include user-picture-alt-fx('flip-horizontal-hover 1s infinite .5s linear');
  }
}
